---
phase: 03-recipe-catalogue
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/app/recipes/page.tsx
  - src/app/recipes/loading.tsx
  - src/components/search-bar.tsx
  - src/components/tag-filter.tsx
  - src/components/pagination-controls.tsx
  - src/components/recipe-grid.tsx
  - src/app/page.tsx
autonomous: false

must_haves:
  truths:
    - "User sees a grid of recipe cards with pagination at /recipes"
    - "User can type in search bar and results filter by recipe name"
    - "User can click tag badges to filter recipes, and filters combine with AND logic"
    - "Search and tag filters preserve each other when modified (no state loss)"
    - "Pagination resets to page 1 when search or filter changes"
    - "URL reflects current search/filter/page state (shareable, bookmarkable)"
    - "Loading skeleton shows while page data loads"
  artifacts:
    - path: "src/app/recipes/page.tsx"
      provides: "Catalogue page Server Component with search, filter, pagination"
      min_lines: 30
    - path: "src/components/search-bar.tsx"
      provides: "Client-side search input that updates URL params"
      contains: "use client"
    - path: "src/components/tag-filter.tsx"
      provides: "Client-side tag toggle badges that update URL params"
      contains: "use client"
    - path: "src/components/pagination-controls.tsx"
      provides: "Pagination navigation using shadcn Pagination"
    - path: "src/components/recipe-grid.tsx"
      provides: "Responsive grid layout for RecipeCard components"
    - path: "src/app/recipes/loading.tsx"
      provides: "Skeleton loading state for catalogue page"
  key_links:
    - from: "src/app/recipes/page.tsx"
      to: "src/db/queries/recipes.ts"
      via: "direct import and call"
      pattern: "getRecipes\\("
    - from: "src/app/recipes/page.tsx"
      to: "src/db/queries/tags.ts"
      via: "direct import and call"
      pattern: "getAllTags\\("
    - from: "src/components/recipe-grid.tsx"
      to: "src/components/recipe-card.tsx"
      via: "passes RecipeWithTags object to RecipeCard"
      pattern: "recipe=\\{recipe\\}"
    - from: "src/components/search-bar.tsx"
      to: "URL search params"
      via: "router.push with URLSearchParams"
      pattern: "router\\.push|router\\.replace"
    - from: "src/components/tag-filter.tsx"
      to: "URL search params"
      via: "router.push with URLSearchParams"
      pattern: "router\\.push|router\\.replace"
---

<objective>
Build the recipe catalogue page at /recipes with a responsive grid of recipe cards, search bar, tag filter toggles, and pagination controls. All filter/search/page state stored in URL search params.

Purpose: This is the primary user-facing feature of Phase 3 -- browsing and finding recipes. It connects the query layer (Plan 01) to a usable UI.
Output: Fully functional /recipes page with search, tag filtering, pagination, loading skeleton, and home page redirect.
</objective>

<execution_context>
@/Users/jimmydore/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jimmydore/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-recipe-catalogue/03-RESEARCH.md
@.planning/phases/03-recipe-catalogue/03-01-SUMMARY.md
@src/db/schema/recipes.ts
@src/db/schema/tags.ts
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create catalogue page with search, filters, and pagination</name>
  <files>
    src/app/recipes/page.tsx
    src/app/recipes/loading.tsx
    src/components/search-bar.tsx
    src/components/tag-filter.tsx
    src/components/pagination-controls.tsx
    src/components/recipe-grid.tsx
  </files>
  <action>
    1. Create src/components/recipe-grid.tsx (Server Component):
       - Props: `{ recipes: RecipeWithTags[] }` -- import RecipeWithTags from src/db/queries/recipes
       - Renders a responsive CSS grid: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6`
       - Maps over recipes rendering `<RecipeCard recipe={recipe} />` for each (passes the full RecipeWithTags object -- tags are already nested on the recipe, no separate tags prop needed)
       - Shows empty state message "Aucune recette trouvee" when recipes array is empty

    2. Create src/components/search-bar.tsx ("use client"):
       - Props: `{ defaultValue: string }`
       - Uses shadcn Input with type="search", placeholder="Rechercher une recette..."
       - On change: update URL search param `q` with the input value, delete `page` param (reset to page 1)
       - Use `useRouter()`, `useSearchParams()`, `usePathname()` from next/navigation
       - Use `useTransition()` for pending state (add opacity-50 class while pending)
       - Debounce: use a 300ms setTimeout in the onChange handler. Clear previous timeout on each keystroke. Store timeout ref with useRef.
       - Preserve existing params (tags, etc.) when updating search

    3. Create src/components/tag-filter.tsx ("use client"):
       - Props: `{ tags: Array<{ id: string; name: string; slug: string }>; activeSlugs: string[] }`
       - Render each tag as a shadcn Badge that toggles on/off
       - Active tags: variant="default" (filled). Inactive: variant="outline"
       - On click: toggle the tag slug in the `tags` URL search param array. Multiple tags = repeated `tags=slug1&tags=slug2`. Delete `page` param on change.
       - Use `useRouter()`, `useSearchParams()`, `usePathname()` from next/navigation
       - Use `useTransition()` for pending opacity
       - Preserve other params (q, etc.) when toggling tags

    4. Create src/components/pagination-controls.tsx (Server Component or "use client"):
       - Props: `{ currentPage: number; totalPages: number }`
       - Use shadcn Pagination components (Pagination, PaginationContent, PaginationItem, PaginationPrevious, PaginationNext, PaginationLink, PaginationEllipsis)
       - Generate page links as href with proper URL search params (preserve q, tags)
       - Show: first page, ellipsis, current-1, current, current+1, ellipsis, last page (standard pagination pattern)
       - Hide entirely if totalPages <= 1
       - Since this needs to read current searchParams to build hrefs, make it a client component that reads useSearchParams() and generates href strings for each page link. The shadcn Pagination uses <a> tags natively.

    5. Create src/app/recipes/page.tsx (Server Component):
       - CRITICAL: searchParams is a Promise in Next.js 16. Must `await searchParams`.
       - Type: `searchParams: Promise<{ page?: string; q?: string; tags?: string | string[] }>`
       - Parse params: page = Math.max(1, Number(params.page) || 1), query = params.q || "", tagSlugs = normalize tags to string[]
       - Call getRecipes({ page, query, tagSlugs }) and getAllTags() in parallel with Promise.all
       - getRecipes returns `{ recipes: RecipeWithTags[], totalCount, totalPages, currentPage, pageSize }` -- recipes already have tags nested
       - Layout:
         ```
         <main className="container mx-auto px-4 py-8">
           <h1 className="text-3xl font-bold mb-6">Recettes</h1>
           <div className="flex flex-col gap-6">
             <SearchBar defaultValue={query} />
             <TagFilter tags={allTags} activeSlugs={tagSlugs} />
             <p className="text-sm text-muted-foreground">{totalCount} recette(s)</p>
             <RecipeGrid recipes={recipesResult.recipes} />
             <PaginationControls currentPage={recipesResult.currentPage} totalPages={recipesResult.totalPages} />
           </div>
         </main>
         ```
       - Add metadata: `export const metadata = { title: "Recettes | Meal Prep" }`

    6. Create src/app/recipes/loading.tsx:
       - Use shadcn Skeleton components to show placeholder grid
       - Same layout as the page: title skeleton, search bar skeleton, grid of 12 card skeletons (matching RecipeCard dimensions)

    7. Update src/app/page.tsx:
       - Replace the current Hello World / DB status page with a redirect to /recipes
       - Use `import { redirect } from "next/navigation"` and call `redirect("/recipes")` in the component body
       - This makes / automatically send users to the catalogue
  </action>
  <verify>
    - `pnpm tsc --noEmit` passes
    - `pnpm check` (Biome) passes
    - `pnpm dev` starts without errors
    - Navigate to http://localhost:3000 -- redirects to /recipes
    - /recipes shows recipe grid (if recipes exist in DB) or empty state
    - Typing in search bar updates URL with ?q=... parameter
    - Clicking tag badges toggles ?tags=... in URL
    - Clicking pagination links changes ?page=... in URL
    - Loading skeleton shows on initial page load
  </verify>
  <done>
    /recipes page renders recipe cards in a responsive grid with working search bar, tag filter toggles, and pagination. All state is in URL search params. Home page (/) redirects to /recipes. Loading skeleton displays during data fetch.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Recipe catalogue page at /recipes with search, tag filtering, and pagination. Home page redirects to /recipes.</what-built>
  <how-to-verify>
    Prerequisites: Ensure you have recipes in your local database (run the pipeline or seed data).

    1. Visit http://localhost:3000 -- should redirect to /recipes
    2. Verify recipe cards display in a responsive grid with images, titles, time, tags
    3. Type a recipe name in the search bar -- results should filter, URL should show ?q=...
    4. Clear search, click a tag badge -- recipes should filter to that tag, badge should appear filled
    5. Click a second tag -- recipes should show only recipes matching BOTH tags (AND logic)
    6. Verify pagination: if more than 12 recipes, page controls appear. Click page 2 -- URL shows ?page=2
    7. Combine search + tag filter -- verify both params in URL, results match both criteria
    8. Resize browser window -- grid should be responsive (4 cols on xl, 3 on lg, 2 on sm, 1 on mobile)
    9. Check that recipe card images load (from static.jow.fr) without broken image errors
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm tsc --noEmit` -- no type errors
2. `pnpm check` -- Biome passes
3. http://localhost:3000 redirects to /recipes
4. /recipes displays recipe cards with images, titles, tags
5. Search bar filters by name, tag badges filter by tag, pagination navigates pages
6. All state reflected in URL search params
7. Loading skeleton shows during page transitions
</verification>

<success_criteria>
- /recipes page renders paginated recipe cards in responsive grid
- Search bar filters recipes by title with debounced URL param updates
- Tag filter badges toggle AND-logic filtering via URL params
- Pagination controls navigate between pages, preserving search/filter state
- URL is shareable and bookmarkable with all filter state encoded
- Loading skeleton appears during initial load and navigation
- Home page (/) redirects to /recipes
- All code compiles and passes lint
</success_criteria>

<output>
After completion, create `.planning/phases/03-recipe-catalogue/03-02-SUMMARY.md`
</output>
